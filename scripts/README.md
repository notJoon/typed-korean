# scripts/

## Key format

ComposeTable keys use the format `"초_중"` for open syllables (no jongseong) and `"초_중_종"` for closed syllables. Earlier iterations used `"초_중_null"` for the open case, but this was changed to omit the null segment entirely. The motivation is that the type-level consumer of ComposeTable must construct the key from jamo components, and generating the string `"null"` from a `null` type requires an extra conditional type branch. By omitting the segment, the key construction simplifies to a template literal that is either `${cho}_${jung}` or `${cho}_${jung}_${jong}`, selected by a single `extends null` check on the jongseong.

## Relationship between the tables

OpenSyllable, JamoTable, and ComposeTable serve distinct stages of the pipeline, with no overlap in responsibility. OpenSyllable handles batchim detection for all syllables, including user-declared nouns, without any vocabulary dependency. JamoTable and ComposeTable are conceptual inverses, both vocabulary-driven, but they are not symmetric in structure: JamoTable is a mapped type keyed by syllable characters, while ComposeTable is keyed by underscore-delimited jamo strings.

In practice, the three types are never used together in a single type expression. OpenSyllable is consulted for particle selection, JamoTable at the beginning of the conjugation pipeline to inspect the stem, and ComposeTable at the end to assemble the result. There is no round-trip through multiple tables in a single conditional type chain, which avoids deep nesting.

## Regeneration

All three types are regenerated by running `npm run codegen`, which executes `scripts/gen-jamo-table.ts`. The generated files are committed to version control; the codegen script serves as their source of truth. A CI check runs the codegen and verifies that the committed files are up to date (no diff after regeneration). When a new verb is added to the vocabulary file (`scripts/vocabulary.ts`), the codegen must be re-run to ensure both JamoTable and ComposeTable include any newly required entries.

OpenSyllable does not depend on the vocabulary. It is derived solely from the Unicode constants and only needs regeneration if the project's Unicode coverage policy changes (for example, to include compatibility jamo or archaic syllables). In practice, it is regenerated alongside the vocabulary-driven tables for simplicity.
