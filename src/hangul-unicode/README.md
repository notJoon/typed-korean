# hangul-unicode (Layer 0)

Type-level Hangul Unicode utilities for `typed-korean`.

This module provides the foundational Layer 0 primitives used by higher grammar layers:

- Batchim detection (받침 판별)
- Last-vowel extraction (마지막 중성 추출)
- Syllable recomposition from jamo (자모 기반 음절 합성)
- Basic string literal helpers for type-level pipelines

## Design

TypeScript types cannot perform Unicode codepoint arithmetic directly, so this layer uses code-generated lookup tables:

- `src/generated/jamo-table.gen.ts`
  - `OpenSyllable`: all open Hangul syllables (no final consonant)
  - `JamoTable`: vocabulary-driven syllable decomposition table
- `src/generated/compose-table.gen.ts`
  - `ComposeTable`: vocabulary-driven jamo-to-syllable composition table

These are generated by `scripts/gen-jamo-table.ts`.

```sh
npm run codegen
```

The project assumes NFC-composed Hangul input.

## Type-Level API

From `src/hangul-unicode/string-utils.ts`:

- `LastChar<S>`
- `DropLast<S>`
- `IfLiteral<S, Then, Else>`

From `src/hangul-unicode/jamo.ts`:

- `HasBatchim<S>`
- `LastVowel<S>`
- `LastJong<S>`
- `SecondToLastVowel<S>`
- `Compose<Cho, Jung, Jong>`

Example expectations:

- `HasBatchim<"밥">` -> `true`
- `HasBatchim<"사과">` -> `false`
- `LastVowel<"먹">` -> `"ㅓ"`
- `Compose<"ㅇ", "ㅘ", null>` -> `"와"`

## Known Issues

- Non-Hangul literals such as `HasBatchim<"A">` may currently evaluate to `true`.
- To keep type footprint and compile cost lower, this project intentionally does not generate an exhaustive closed-syllable union (10,773 entries).

## Runtime Helpers (Test-Only)

`src/hangul-unicode/runtime.ts` contains runtime equivalents for unit testing:

- `isHangulSyllable`
- `decomposeSyllable`
- `composeSyllable`
- `hasBatchim`

These are intended only for test verification and not as the primary public surface of this type-level library.

## Tests

- Type-level tests: `tests/hangul-unicode.test-d.ts`
- Runtime unit tests: `tests/hangul-unicode.runtime.test.ts`

Run:

```sh
npm run test
npm run typecheck
npm run format
```
